<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>CrashRpt: Using crprober.exe Tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="style.css" rel="stylesheet" type="text/css">
<link rel="icon" href="../favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>

<div style="padding:10px">
<table border="0" bgcolor="#FFFFFF" cellspacing="5" width="100%">
 <tr>
  <td width="24px" rowspan="2"><img src="../logo.png" alt="Logo" /></td>
  <td><font family="Arial" size="+2">crashrpt</font></td>
  <td rowspan="2" align="right"></td>
 </tr>
 <tr>
  <td colspan="2"><span style="font-size:0.9em"><i>A crash reporting system for Windows applications</i></a></td>
 </tr>
</table>
</div>


<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Contents</span></a></li>
      <li><a href="modules.html"><span>API&nbsp;Reference</span></a></li>
      <li><a href="files.html"><span>File&nbsp;Reference</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">CrashRpt Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="using_error_reports.html">Using Error Reports</a>&nbsp;&raquo&nbsp;<a class="el" href="automating_crash_report_processing.html">Automating Crash Report Processing</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="crprober_tool">Using crprober.exe Tool </a></h1><b>Since v1.2.0</b>, CrashRpt provides a tool named <b>crprober.exe</b> that can be used for automating crash report processing. To run the tool, go to <code>bin</code> directory and type <b>crprober.exe</b> in the command line.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>If you run the precompiled tool from <code>bin</code> folder and do not compile it yourself, you might experience some problems if Visual C++ 2010 Redistributable files are not installed on your machine. There may be error messages like 'The application configuration is incorrect' and so on. If you do not have Visual C++ 2010 Redistributable on your machine and do not want to install it, please compile the solution yourself as described in <a class="el" href="compiling_crashrpt.html">Compiling CrashRpt</a>.</dd></dl>
Note that <b>crprober.exe</b> shouldn't be distributed to end users. They just won't be able to use it without symbol files.<p>
The tool can be used to open error report files generated by any version of CrashRpt. However it works the best with reports created by version 1.1 and higher.<p>
Typically an error report file contains an associated MD5 hash file. The crprober tool can perform integrity check using the MD5 hash file. When you receive a report using HTTP connection, the MD5 hash can be retrieved from 'md5' script argument. When you receive a report using E-mail, the hash is attached to the mail message. For more information, see <a class="el" href="sending_error_reports.html">Sending Error Reports</a>.<p>
The tool extracts information about the error report (its GUID, version of CrashRpt that generated the report, creation time in UTC format), the information about the application that sent the report (name, version, path to executable file, the list of loaded modules), information about the operating system (name, version, service pack, CPU info), and information about the exception (exception address, exception code, stack trace). It presents the extracted information in text form (creates a text file or writes to the terminal).<p>
The error report can't be processed properly without symbol files (*.PDB) generated by Visual Studio for your application. You typically store the symbol files locally when preparing to software release. For more information, see <a class="el" href="preparing_to_software_release.html">Preparing to Software Release</a>.<p>
The <b>crprober.exe</b> is a console tool. It accepts several command line arguments. The arguments are listed in the table below: <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td><b>Name</b> </td><td><b>Description</b> <p>
</td></tr>
<tr>
<td>/? </td><td>Prints the usage help.<p>
</td></tr>
<tr>
<td>/f &lt;input_file&gt; </td><td>Required. Absolute or relative path to input ZIP file name.<p>
</td></tr>
<tr>
<td>/fmd5 &lt;md5_file_or_dir&gt; </td><td>Optional. Path to .md5 file containing MD5 hash for the &lt;input_file&gt; or directory name where to search for the .md5 file. If this parameter is omitted, the .md5 file is searched in the directory where &lt;input_file&gt; is located.<p>
</td></tr>
<tr>
<td>/o &lt;out_file_or_dir&gt; </td><td>Optional. Output file name or directory name. Or use empty name "" to direct output to terminal. If this parameter is omitted, output is not generated.<p>
</td></tr>
<tr>
<td>/sym &lt;sym_search_dirs&gt; </td><td>Optional. Symbol files search directory or list of directories separated with semicolon. If this parameter is omitted, symbol files are searched using the default search sequence.<p>
</td></tr>
<tr>
<td>/ext &lt;extract_dir&gt; </td><td>Optional. Specifies the directory where to extract all files contained in error report. If this parameter is omitted, files are not extracted.<p>
</td></tr>
<tr>
<td>/get &lt;table_id&gt; &lt;column_id&gt; &lt;row_id&gt; </td><td>Optional. Specifies the table ID, column ID and row index of the property to retrieve. If this parameter specified, the property is written to the output file or to terminal, as defined by /o parameter. For the list of properties you can retrieve, see <a class="el" href="using_crashrptprobe_api.html">Using CrashRptProbe API</a>. </td></tr>
</table>
<p>
The crprober tool can return one of the following return codes:<p>
<table border="1" cellspacing="3" cellpadding="3">
<tr>
<td><b> Return Code</b> </td><td><b>Meaning</b> <p>
</td></tr>
<tr>
<td>0 </td><td>OK.<p>
</td></tr>
<tr>
<td>1 </td><td>Unexpected error.<p>
</td></tr>
<tr>
<td>2 </td><td>Invalid command line argument. Ensure you pass correct parameters.<p>
</td></tr>
<tr>
<td>3 </td><td>Integrity check failed (MD5 hash mismatch)<p>
</td></tr>
<tr>
<td>4 </td><td>Error extracting file. Ensure the extraction path is correct.<p>
</td></tr>
</table>
<h2><a class="anchor" name="crprober_examples">
Examples of Use</a></h2>
The following example processes the 'error_report.zip' file and writes output to the terminal. Symbol files are assumed to be located in 'D:\Symbol Files' directory. <div class="fragment"><pre class="fragment">crprober.exe /f error_report.zip /o <span class="stringliteral">""</span> /sym <span class="stringliteral">"D:\Symbol Files"</span>
</pre></div><p>
The following example opens 'error_report.zip' file located in the current directory, performs integrity check using 'error_report.zip.md5' file and writes output to the 'error_report.zip.txt' file. Symbol files are assumed to be located in 'D:\Symbol Files' or in 'D:\MyApp\sym' directory. <div class="fragment"><pre class="fragment">crprober.exe /f error_report.zip /md5 error_report.zip.md5 /o error_report.zip.txt /sym <span class="stringliteral">"D:\Symbol Files;D:\MyApp\sym"</span>
</pre></div><p>
The following example retrieves the application name from the error report and writes it to terminal: <div class="fragment"><pre class="fragment">crprober.exe /f error_report.zip /o <span class="stringliteral">""</span> /sym <span class="stringliteral">"D:\Symbol Files;D:\MyApp\sym"</span> /<span class="keyword">get</span> XmlDescMisc AppName 0
</pre></div><p>
The following example retrieves the count of rows in the MdmpModules table and writes it to terminal: <div class="fragment"><pre class="fragment">crprober.exe /f error_report.zip /o <span class="stringliteral">""</span> /sym <span class="stringliteral">"D:\Symbol Files;D:\MyApp\sym"</span> /<span class="keyword">get</span> MdmpModules RowCount 0
</pre></div><h2><a class="anchor" name="crprober_reallife_scenario">
Real-Life Usage Scenario</a></h2>
Let's assume you receive error reports over E-mail. To automate error reports extraction from E-mail attachments, you may use some extension of your mail program. For example, if you use Mozilla Thunderbird, you can use <a href="http://www.eviljeff.com/?page=moz-extensions">Attachment Extractor extension</a>. You can configure the extension to determine the error report messages on the fly and extract email attachments (ZIP and MD5 files) to some folder.<p>
When you have ZIP and MD5 files stored in the directory, you may want to process them all at once. You may want to process reports from the latest version of your application, ignoring all others. You may want to group similar error reports, for example, by stack trace of the exception thread. You may want to copy processed reports to some other directory, leaving not processed reports where they are. You also may want to move corrupted error reports to some folder, to move error reports not having exception information to another folder, and error reports not having symbols loaded for any stack frame to the third folder. You can automate this task using a batch (BAT) script.<p>
Below an example batch script is presented (you can find the script in processing\scripts\postprocess.bat file).<ul>
<li>The script recursively searches <em>INPUT_DIR</em> folder and processes files matching the pattern defined by <em>INPUT_FILE_PATTERN</em> variable. For example, "*.zip" pattern means to process all ZIP files in a directory.</li><li>The script accepts only reports having application name as defined by <em>ACCEPTABLE_APPNAME</em> variable. Keep this empty to accept all appnames.</li><li>The script accepts only reports having application version as defined by <em>ACCEPTABLE_APPVERSION</em> variable. Keep this empty to accept all app versions.</li><li>The script searches for symbol files in <em>SYM_SEARCH_DIRS</em>. This may be semicolon-separated list of directories.</li><li>The script saves processed reports and output text files to <em>SAVE_RESULTS_TO_DIR</em> directory. It groups error reports by similar stack traces, placing them to a single subfolder. Error reports not having exception information are placed into NoExceptionInfo subfolder, and error reports not having symbols loaded for any stack trace are placed to NoSymbolsLoaded subfolder.</li><li>The script moves corrupted error reports to the folder defined by <em>SAVE_INVALID_REPORTS_TO_DIR</em> parameter.</li></ul>
<p>
<div class="fragment"><pre class="fragment">@echo off
rem Process a group of ZIP error report files

<span class="keyword">set</span> INPUT_DIR=<span class="stringliteral">"E:\ErrorReports"</span>
<span class="keyword">set</span> INPUT_FILE_PATTERN=<span class="stringliteral">"*.zip"</span>
<span class="keyword">set</span> ACCEPTABLE_APPNAME=<span class="stringliteral">"CrashRpt Tests"</span>
<span class="keyword">set</span> ACCEPTABLE_APPVERSION=<span class="stringliteral">"1.2.0"</span>
<span class="keyword">set</span> SYM_SEARCH_DIRS=<span class="stringliteral">"D:\Projects\CrashRpt\CrashRptSaved\1.2.0"</span>
<span class="keyword">set</span> SAVE_RESULTS_TO_DIR=<span class="stringliteral">"valid_reports\"</span>
<span class="stringliteral">set SAVE_INVALID_REPORTS_TO_DIR="</span>invalid_reports\<span class="stringliteral">"</span>
<span class="stringliteral">set CRPROBER_PATH="</span>D:\Projects\CrashRpt\bin\crprober.exe<span class="stringliteral">"</span>
<span class="stringliteral"></span>
<span class="stringliteral">mkdir %SAVE_RESULTS_TO_DIR%</span>
<span class="stringliteral"></span>
<span class="stringliteral">for /R %INPUT_DIR% %%f in ( %INPUT_FILE_PATTERN% ) do call :process_report "</span>%%f<span class="stringliteral">"</span>
<span class="stringliteral">erase temp.txt</span>
<span class="stringliteral">exit </span>
<span class="stringliteral"></span>
<span class="stringliteral">:process_report</span>
<span class="stringliteral"></span>
<span class="stringliteral">  echo Processing file: %1</span>
<span class="stringliteral"></span>
<span class="stringliteral">  if %ACCEPTABLE_APPNAME%=="</span><span class="stringliteral">" goto appname_ok</span>
<span class="stringliteral">  rem Get application name from the crash report file and write it to "</span>temp.txt<span class="stringliteral">"</span>
<span class="stringliteral">  %CRPROBER_PATH% /f %1 /o "</span>temp.txt<span class="stringliteral">" /get XmlDescMisc AppName 0</span>
<span class="stringliteral">  if not %errorlevel%==0 goto failed</span>
<span class="stringliteral"> </span>
<span class="stringliteral">  set /p app_name=&lt;temp.txt</span>
<span class="stringliteral">  if "</span>%app_name%<span class="stringliteral">"==%ACCEPTABLE_APPNAME% goto appname_ok</span>
<span class="stringliteral">  goto done</span>
<span class="stringliteral"></span>
<span class="stringliteral">:appname_ok</span>
<span class="stringliteral"></span>
<span class="stringliteral">  if %ACCEPTABLE_APPVERSION%=="</span><span class="stringliteral">" goto appversion_ok</span>
<span class="stringliteral">  rem Get application version from the crash report file and write it to "</span>temp.txt<span class="stringliteral">"</span>
<span class="stringliteral">  %CRPROBER_PATH% /f %1 /o "</span>temp.txt<span class="stringliteral">" /get XmlDescMisc AppVersion 0</span>
<span class="stringliteral">  if not %errorlevel%==0 goto failed</span>
<span class="stringliteral"> </span>
<span class="stringliteral">  set /p app_version=&lt;temp.txt</span>
<span class="stringliteral">  if "</span>%app_version%<span class="stringliteral">"==%ACCEPTABLE_APPVERSION% goto appversion_ok</span>
<span class="stringliteral"></span>
<span class="stringliteral">  goto done</span>
<span class="stringliteral"></span>
<span class="stringliteral">:appversion_ok</span>
<span class="stringliteral"></span>
<span class="stringliteral">  set stack_md5=NoExceptionInfo</span>
<span class="stringliteral">  %CRPROBER_PATH% /f %1 /o "</span>temp.txt<span class="stringliteral">" /sym %SYM_SEARCH_DIRS%  /get MdmpMisc ExceptionThreadStackMD5 0</span>
<span class="stringliteral">  if not %errorlevel%==0 goto save_results</span>
<span class="stringliteral">  set /p stack_md5=&lt;temp.txt</span>
<span class="stringliteral">  erase temp.txt</span>
<span class="stringliteral"></span>
<span class="stringliteral">  if %stack_md5%=="</span><span class="stringliteral">" set stack_md5=NoSymbolsLoaded</span>
<span class="stringliteral"></span>
<span class="stringliteral">:save_results</span>
<span class="stringliteral"></span>
<span class="stringliteral">  mkdir %SAVE_RESULTS_TO_DIR%%stack_md5%</span>
<span class="stringliteral">  </span>
<span class="stringliteral"></span>
<span class="stringliteral">  rem Process report and write results to text file</span>
<span class="stringliteral">  %CRPROBER_PATH% /f %1 /o %1.txt /sym %SYM_SEARCH_DIRS% </span>
<span class="stringliteral">  echo Return code=%errorlevel%</span>
<span class="stringliteral">  if not %errorlevel%==0 goto failed</span>
<span class="stringliteral"></span>
<span class="stringliteral">:ok</span>
<span class="stringliteral">  move %1 %SAVE_RESULTS_TO_DIR%%stack_md5%</span>
<span class="stringliteral">  move %1.txt %SAVE_RESULTS_TO_DIR%%stack_md5%</span>
<span class="stringliteral">  goto done</span>
<span class="stringliteral"></span>
<span class="stringliteral">:failed</span>
<span class="stringliteral"></span>
<span class="stringliteral"> mkdir %SAVE_INVALID_REPORTS_TO_DIR%</span>
<span class="stringliteral"> move %1 %SAVE_INVALID_REPORTS_TO_DIR%</span>
<span class="stringliteral"> </span>
<span class="stringliteral">:done</span>
<span class="stringliteral">  </span>
<span class="stringliteral">rem Return from subroutine</span>
<span class="stringliteral">goto :eof</span>
</pre></div><p>
When the script finishes, you will have similar error reports groupped in subfolders. The question is what group to start to analyze first? What groups contain the reports of errors occurring most often? The following simple Python script (you can find the script in processing\scripts\basic_stats.py file) can help you to answer this question by getting the count of .txt files in each subfolder and outputting the results into the text file.<p>
<div class="fragment"><pre class="fragment"><span class="comment"># This script calculates how many error reports are in each subdirectory</span>
<span class="comment"># and how many error reports are in total.</span>
<span class="comment"># Edit in_dir and out_file parameters as you need.</span>

<span class="keyword">import</span> os

in_dir = <span class="stringliteral">"D:/Projects/CrashRpt/valid_reports"</span>
out_file = <span class="stringliteral">"stats.txt"</span>


f = open(out_file, <span class="stringliteral">"w"</span>)

<span class="keyword">def </span>get_txt_file_count(dirname):
   count = 0
   <span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(dirname, <span class="keyword">True</span>):
     <span class="keywordflow">for</span> file <span class="keywordflow">in</span> files:
        <span class="keywordflow">if</span> file[-4:] != <span class="stringliteral">".txt"</span>:
            <span class="keywordflow">continue</span>;
        count += 1
     <span class="keywordflow">break</span>;
   <span class="keywordflow">return</span> count

multimap = dict()
<span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(in_dir):
   <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> dirs:
      dir_name = os.path.join(root, dir)
      report_count_in_dir = get_txt_file_count(dir_name)
      <span class="keywordflow">if</span> report_count_in_dir <span class="keywordflow">in</span> multimap.keys():
         multimap[report_count_in_dir].append(dir)
      <span class="keywordflow">else</span>:
         multimap[report_count_in_dir] = [dir]

ordered_list = list(multimap.keys())
ordered_list.sort()
ordered_list.reverse()

total_count = 0
total_groups = 0
<span class="keywordflow">for</span> count <span class="keywordflow">in</span> ordered_list:
  total_groups += len(multimap[count]);
  total_count += count * len(multimap[count])

f.write(<span class="stringliteral">"Total %d reports (100%%) in %d directories\n"</span>%(total_count, total_groups))

n = 1
<span class="keywordflow">for</span> key <span class="keywordflow">in</span> ordered_list:
  <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> multimap[key]:
   percent = key/total_count*100
   f.write(<span class="stringliteral">"%d. %d reports (%0.1f%%) in '%s'\n"</span>%(n, key, percent, dir))
   n = n+1

f.close()
</pre></div><p>
The expected script output:<p>
<div class="fragment"><pre class="fragment">207 error reports in total
105 error reports in <span class="stringliteral">'subdir1'</span>
50 error reports in <span class="stringliteral">'subdir2'</span>
30 error reports in <span class="stringliteral">'subdir3'</span>
20 error reports in <span class="stringliteral">'subdir4'</span>
2 error reports in <span class="stringliteral">'subdir5'</span>
</pre></div><p>
So, the 'subdir1' contains the reports about an error reported the most often. And the 'subdir5' contains the reports about an error reported the most rare. </div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Mon Apr 8 15:41:10 2013 for CrashRpt by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9</small></address>
</body>
</html>
